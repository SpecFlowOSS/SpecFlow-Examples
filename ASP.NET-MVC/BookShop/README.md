SpecFlow BookShop Example
========================

This solution contains an end-to-end example to show how to use SpecFlow for 
ASP.NET MVC applications.

You can find more information about SpecFlow at [http://www.specflow.org/](http://www.specflow.org).

Prerequisites to run the application
====================================

- [Visual Studio 2019 Preview](https://www.visualstudio.com/downloads/) or [Visual Studio Code](https://code.visualstudio.com/)
- [.NET Core 3.0 Preview 7 SDK](https://dotnet.microsoft.com/download/dotnet-core/3.0)

If you use Visual Studio 2019 Preview, we recommend to also use the SpecFlow extension for Visual Studio

Setup Application
=================

- Set the `BookShop.Mvc` project as startup project and run the application. You
  should see some books on the start page of the app.

Automated SpecFlow Acceptance Tests
===================================

With SpecFlow you can define the acceptance criteria in *.feature* files, which 
can be automatically validated through acceptance tests. 
The `BookShop.AcceptanceTests` project contains the feature files for this application,
which describe the implemented behaviour as acceptance criteria (SpecFlow scenarios with examples).
Step definitions (folder *StepDefinitions*) define, how individual scenario steps should be automated.
SpecFlow generated executable unit tests from the defined acceptance criteria scenarios
in the feature files and the step definitions, that you need to define and implement.
The generated unit tests are shown as sub-items of each feature file (e.g. `US01_BookSearch.feature.cs`).

When you build the solution and open the Visual Studio Test Explorer, you should
see all the tests generated from the feature files.

> *__Note__: You might get some Selenium related warnings when you build. Those appear because the Selenium
> library currently does not officially support .NET Core.*

Unit tests are always generated by SpecFlow from the feature files -
when working with the solution from the IDE the generation is triggered when you save a feature file.
When building the solution on a build server, SpecFlow automatically updates the unit tests as an msbuild task.
You should never manually modify the generated unit tests. They are just an artifact generated by the build!

Since SpecFlow 3 the MsBuild Package (`SpecFlow.Tools.MsBuild.Generation`) is required, as it generates the
code-behind files required by SpecFlow. You can get it through the NuGet Package Manager.

Executing SpecFlow Acceptance Tests
===================================

In the Visual Studio Test Explorer select *Run All* tests.

If you've configured the database connection correctly, all tests should pass (green).

A test execution report is generated automatically.
Open the Visual Studio "Output" window and select "Show output from: Tests".
A hyperlink to an HTML execution report should be shown there, which gives an overall test result as well as a break down of each individual scenario execution.

> *__Note__: The report generation is currently not working, since the SpecFlow+ Runner currently does not support .NET Core 3.0* 

As SpecFlow is not a unit test runner on its own, it can generate unit tests for a number of third party unit test runners like MsTest, NUnit, XUnit and SpecFlow+ Runner.
(check the SpecFlow documentation for an up-to-date list of supported unit test runners)

> *__Note__: As SpecFlow+ Runner is currently not compatible with .NET Core 3, the example currently uses xUnit as unit test provider. Therefore the following paragraph is currently invalid.*

The example project is configured to generate unit tests for SpecFlow+ Runner, which is a
unit test runner provided by TechTalk which is specialized for running acceptance/integration tests
(like written in SpecFlow but also without SpecFlow).
SpecFlow+ Runner is provided as a free evaluation version with this example. The only
limitation of the evaluation is, that your tests will be delayed by an arbitrary
time span before being executed.
To find out more about SpecFlow+ Runner and its further benefits for automated acceptance testing
please visit [https://specflow.org/plus/runner/](http://www.specrun.com).

You can easily switch to other unit test providers (such as [NUnit](http://nunit.org/), [XUnit](https://xunit.github.io/), etc.)
by uninstalling the current test provider NuGet package (e.g. `SpecFlow.xUnit`) and installing another (e.g. `SpecFlow.MsTest`).
_Make sure that __only one__ test provider is installed at the same time! Intalling more than one will result in an error._

Using SpecFlow for UI automation
================================

SpecFlow is completely independent of what automation interface is used.

This example automates the tests directly through the Controller of the
MVC web application (this is also sometimes called *automation below the skin*).

Automating below the skin provides several benefits:
less brittle tests, less efforts for automation, better performance of the test suite

However, sometimes behaviour that should be validated cannot be observed
on the controller level, but just on the UI. In that case, some kind of
UI automation has to be implemented.

To demonstrate this, the example implements an alternative automation for all the
`US01_BookSearch.feature` scenarios using Selenium.

To enable the Selenium UI automation, you need to add (uncomment) the
`@web` tag on the `US01_Booksearch` feature file.

You also need to have the correct version of Chrome installed, that can be
driven by the Selenium version used in this example. It might be necessary
to update Chrome or the Selenium version used in this example, to make
the UI automation work.

> *__Note:__ You can also use Firefox or Internet Explorer if you change the Driver 
> in `SeleniumController.cs` in the `Support` folder of the `BookShop.WebTests.Selenium` project.
> Just add (uncomment) the right `using`-statement and WebDriver assignment
> for the browser of your choice (and remove/comment the others).*

As the UI automation relies on a running instance of the application,
you need to first run the web application, before you run the SpecFlow tests
(e.g. start the web project using [Ctrl-F5] and validate the web application is working).

There is an application environment spefically for running tests (`IIS Express Test Environment`),
so make sure to use it. Otherwise, the tests using the UI will fail.

After that, if you have enabled the `@web` tag, and run all the SpecFlow scenarios,
the scenarios of `US01_BookSearch.feature` will be automated through the UI
with Selenium, while the other scenarios are still automated through the controller.

Notice that the phrasing of the scenarios didn't have to be changed, in order
to automate on a different layer. This is a good practice, as SpecFlow scenarios
shouldn't express technical details of the automation, but the intention and
behaviour to be validated.

The different automation is implemented in a separate step-definition assembly,
which is located in the `BookShop.WebTests.Selenium` project.
This project provides alternative step-definitions that use Selenium for automation,
and which are scoped to scenarios having the `@web` tag (`[Binding, Scope(Tag = "web")]`).

Specflow can be configured extensively. Since SpecFlow 3 a `specflow.json` file is the recommended way to configure SpecFlow.
In this example SpecFlow is configured to use `BookShop.WebTests.Selenium` as an external binding assembly
(using `stepAssembly` option), in order to test `US01_BookSearch` with Selenium.
(Please refer to the [SpecFlow documentation](https://specflow.org/documentation/configuration/) to find out more about supported configuration options).